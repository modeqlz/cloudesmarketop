(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(2285)}])},7381:function(e,n,r){"use strict";r.d(n,{Z:function(){return s}});var t=r(5893),l=r(7294);function s(e){let{messages:n=["Считываем данные Telegram…","Проверяем подпись WebApp…","Создаём профиль…","Готово!"],intervalMs:r=900,done:s=!1}=e,[a,i]=(0,l.useState)(0),c=(0,l.useRef)(null),o=(0,l.useMemo)(()=>Array.isArray(n)&&n.length?n:["Загрузка…"],[n]);return(0,l.useEffect)(()=>{if(!s)return c.current=setInterval(()=>{i(e=>(e+1)%o.length)},r),()=>clearInterval(c.current)},[o.length,r,s]),(0,t.jsxs)("div",{className:"loading-card",children:[(0,t.jsxs)("div",{className:"loading-ring",children:[(0,t.jsx)("div",{className:"ring"}),(0,t.jsx)("div",{className:"ring blur"})]}),(0,t.jsx)("div",{className:"loading-text",children:(0,t.jsx)("div",{className:"line",children:o[a]})}),(0,t.jsx)("div",{className:"loading-bar",children:(0,t.jsx)("div",{className:"track",children:(0,t.jsx)("span",{className:"fill"})})})]})}},2285:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return o}});var t=r(5893),l=r(7294),s=r(9008),a=r.n(s),i=r(7381);let c=async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:900;return Promise.all([e,new Promise(e=>setTimeout(e,n))]).then(e=>{let[n]=e;return n})};function o(){let[e,n]=(0,l.useState)(!1),[r,s]=(0,l.useState)(!1),[o,d]=(0,l.useState)(null);async function u(){d(null),s(!0);try{var e;let n=null===(e=window.Telegram)||void 0===e?void 0:e.WebApp;if(!n){d("Открой мини-апку из Telegram (кнопка \xabОткрыть\xbb в чате бота).");return}let r=n.initData||"";if(!r){d("Telegram не передал initData. Нажми ⋯ → \xabОбновить страницу\xbb.");return}let t=await c(fetch("/api/auth/telegram",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initData:r})}).then(e=>e.json()));t.ok?(localStorage.setItem("profile",JSON.stringify(t.profile||null)),sessionStorage.removeItem("logged_out"),window.location.href="/home"):d(t.error||"Не удалось пройти проверку Telegram.")}catch(e){d("Сетевая ошибка. Попробуй снова.")}finally{s(!1)}}return(0,l.useEffect)(()=>{try{let e=localStorage.getItem("profile"),n="1"===sessionStorage.getItem("logged_out");if(e&&!n){window.location.replace("/home");return}}catch(e){}},[]),(0,l.useEffect)(()=>{var e;let r=null===(e=window.Telegram)||void 0===e?void 0:e.WebApp;r&&(n(!0),r.ready(),r.expand())},[]),(0,l.useEffect)(()=>{if(!r)return;let e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[r]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a(),{children:(0,t.jsx)("title",{children:"Spectra Market — Вход через Telegram"})}),(0,t.jsx)("div",{className:"container",children:(0,t.jsxs)("div",{className:"hero",children:[(0,t.jsxs)("div",{className:"brand",children:[(0,t.jsx)("img",{src:"/plane.svg",alt:"",width:"18",height:"18"}),(0,t.jsx)("span",{children:"Spectra Market"})]}),(0,t.jsx)("h1",{className:"h1",children:"Заходи через Telegram"}),(0,t.jsx)("p",{className:"lead",children:"Моментальная авторизация без паролей. Мы получим только твои публичные данные Telegram (имя, юзернейм, аватар) — и создадим профиль."}),(0,t.jsxs)("div",{className:"row",children:[(0,t.jsxs)("button",{className:"btn btn-primary",onClick:u,disabled:r,children:[(0,t.jsx)("img",{src:"/plane.svg",alt:"",width:"18",height:"18"}),r?"Проверяем…":"Continue"]}),(0,t.jsx)("a",{className:"btn btn-ghost",href:"https://t.me/",target:"_blank",rel:"noreferrer",children:"Join our Telegram Community"})]}),(0,t.jsxs)("div",{className:"foot",children:["Продолжая, вы соглашаетесь с"," ",(0,t.jsx)("a",{href:"#",onClick:e=>e.preventDefault(),children:"Политикой конфиденциальности"})," и"," ",(0,t.jsx)("a",{href:"#",onClick:e=>e.preventDefault(),children:"Условиями сервиса"}),"."]}),o&&(0,t.jsxs)("div",{className:"foot",style:{color:"#ffb4b4"},children:["Ошибка: ",o]})]})}),r&&(0,t.jsxs)("div",{className:"overlay","aria-hidden":!0,children:[(0,t.jsx)("div",{className:"overlay-backdrop"}),(0,t.jsxs)("div",{className:"overlay-panel",children:[(0,t.jsx)(i.Z,{messages:["Считываем данные Telegram…","Проверяем подпись WebApp…","Создаём профиль…","Подгружаем аватар…"],intervalMs:600}),(0,t.jsx)("div",{className:"overlay-hint",children:"Это займёт пару секунд…"})]})]})]})}},9008:function(e,n,r){e.exports=r(7828)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);
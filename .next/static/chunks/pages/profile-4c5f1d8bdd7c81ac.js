(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{9344:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return t(2820)}])},7381:function(e,r,t){"use strict";t.d(r,{Z:function(){return i}});var n=t(5893),s=t(7294);function i(e){let{messages:r=["Считываем данные Telegram…","Проверяем подпись WebApp…","Создаём профиль…","Готово!"],intervalMs:t=900,done:i=!1}=e,[l,a]=(0,s.useState)(0),c=(0,s.useRef)(null),d=(0,s.useMemo)(()=>Array.isArray(r)&&r.length?r:["Загрузка…"],[r]);return(0,s.useEffect)(()=>{if(!i)return c.current=setInterval(()=>{a(e=>(e+1)%d.length)},t),()=>clearInterval(c.current)},[d.length,t,i]),(0,n.jsxs)("div",{className:"loading-card",children:[(0,n.jsxs)("div",{className:"loading-ring",children:[(0,n.jsx)("div",{className:"ring"}),(0,n.jsx)("div",{className:"ring blur"})]}),(0,n.jsx)("div",{className:"loading-text",children:(0,n.jsx)("div",{className:"line",children:d[l]})}),(0,n.jsx)("div",{className:"loading-bar",children:(0,n.jsx)("div",{className:"track",children:(0,n.jsx)("span",{className:"fill"})})})]})}},2106:function(e,r,t){"use strict";t.d(r,{a:function(){return i}});var n=t(7294);function s(){try{localStorage.removeItem("profile"),sessionStorage.removeItem("profile"),sessionStorage.setItem("logged_out","1")}catch(e){}}function i(){let[e,r]=(0,n.useState)(null),[t,i]=(0,n.useState)(!0),[l,a]=(0,n.useState)(null),c=async e=>{try{let t=await fetch("/api/validate-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({telegram_id:e.id})}),n=await t.json();if(!t.ok){if("USER_DELETED"===n.code)return console.log("User was deleted from database, logging out..."),s(),r(null),a("Ваш профиль был удален. Необходимо войти заново."),setTimeout(()=>{window.location.replace("/")},2e3),!1;throw Error(n.error||"Ошибка валидации")}return!0}catch(e){return console.error("Validation error:",e),a(e.message),!1}};return(0,n.useEffect)(()=>{let e=async()=>{try{if("1"===sessionStorage.getItem("logged_out")){r(null),i(!1);return}let e=function(){try{let e=localStorage.getItem("profile");if(e)return JSON.parse(e)}catch(e){}try{let e=sessionStorage.getItem("profile");if(e)return JSON.parse(e)}catch(e){}return null}();if(!e){r(null),i(!1);return}await c(e)&&r(e)}catch(e){console.error("Auth check error:",e),a(e.message),r(null)}finally{i(!1)}};e();let t=setInterval(e,3e4);return()=>clearInterval(t)},[]),{user:e,loading:t,error:l,logout:()=>{s(),r(null),window.location.replace("/")},validateUser:c}}},2820:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return d}});var n=t(5893),s=t(7294),i=t(9008),l=t.n(i),a=t(7381),c=t(2106);function d(){var e;let{user:r,loading:t,error:i,logout:d}=(0,c.a)();if((0,s.useEffect)(()=>{t||r||window.location.replace("/")},[r,t]),t)return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l(),{children:(0,n.jsx)("title",{children:"Профиль — Spectra Market"})}),(0,n.jsxs)("div",{className:"overlay","aria-hidden":!0,children:[(0,n.jsx)("div",{className:"overlay-backdrop"}),(0,n.jsxs)("div",{className:"overlay-panel",children:[(0,n.jsx)(a.Z,{messages:["Проверяем профиль…","Валидируем данные…","Загружаем информацию…","Готовим профиль…"],intervalMs:700}),(0,n.jsx)("div",{className:"overlay-hint",children:"Секунду…"})]})]})]});if(i)return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l(),{children:(0,n.jsx)("title",{children:"Профиль — Spectra Market"})}),(0,n.jsx)("div",{className:"container",children:(0,n.jsxs)("div",{className:"hero",style:{maxWidth:560,textAlign:"center",padding:"32px"},children:[(0,n.jsxs)("div",{style:{color:"#ffb4b4",marginBottom:16},children:["⚠️ ",i]}),(0,n.jsx)("div",{children:"Перенаправляем на главную..."})]})})]});if(!r)return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l(),{children:(0,n.jsx)("title",{children:"Профиль — Spectra Market"})}),(0,n.jsx)("div",{className:"container",children:(0,n.jsxs)("div",{className:"hero",style:{maxWidth:560,textAlign:"center",padding:"32px"},children:[(0,n.jsx)("p",{className:"lead",style:{marginBottom:16},children:"Нет данных профиля."}),(0,n.jsx)("div",{className:"row",style:{justifyContent:"center"},children:(0,n.jsx)("a",{className:"btn btn-primary",href:"/",children:"На главную"})})]})})]});let o=[r.first_name,r.last_name].filter(Boolean).join(" ")||"Без имени",u=r.username?"@"+r.username:"без username",h=r.photo_url||"/placeholder.png",m=["YOUR_TELEGRAM_ID"].includes(null===(e=r.telegram_id)||void 0===e?void 0:e.toString());return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l(),{children:(0,n.jsx)("title",{children:"Профиль — Spectra Market"})}),(0,n.jsx)("div",{className:"container",children:(0,n.jsxs)("div",{className:"hero",style:{maxWidth:560},children:[(0,n.jsxs)("div",{className:"brand",style:{justifyContent:"space-between",width:"100%"},children:[(0,n.jsx)("span",{children:"Профиль"}),(0,n.jsx)("button",{className:"btn btn-ghost",onClick:d,children:"Выйти"})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:14,marginTop:6},children:[(0,n.jsx)("img",{src:h,alt:"avatar",style:{width:56,height:56,borderRadius:16,objectFit:"cover",border:"1px solid var(--border)"}}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"h1",style:{fontSize:22,margin:"0 0 4px"},children:o}),(0,n.jsx)("div",{className:"lead",style:{fontSize:14,margin:0},children:u})]})]}),(0,n.jsxs)("div",{style:{marginTop:16,opacity:.85,fontSize:14},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("b",{children:"ID:"})," ",r.telegram_id]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("b",{children:"Источник:"})," Telegram WebApp"]})]}),m&&(0,n.jsx)("div",{style:{marginTop:20},children:(0,n.jsx)("a",{href:"/admin",className:"btn btn-primary",style:{width:"100%",textAlign:"center"},children:"\uD83D\uDEE0️ Админ-панель"})})]})})]})}},9008:function(e,r,t){e.exports=t(7828)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=9344)}),_N_E=e.O()}]);
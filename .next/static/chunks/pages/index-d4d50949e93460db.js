(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,l,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(2285)}])},7381:function(e,l,n){"use strict";n.d(l,{Z:function(){return s}});var r=n(5893),t=n(7294);function s(e){let{messages:l=["Считываем данные Telegram…","Проверяем подпись WebApp…","Создаём профиль…","Готово!"],intervalMs:n=900,done:s=!1}=e,[a,i]=(0,t.useState)(0),o=(0,t.useRef)(null),c=(0,t.useMemo)(()=>Array.isArray(l)&&l.length?l:["Загрузка…"],[l]);return(0,t.useEffect)(()=>{if(!s)return o.current=setInterval(()=>{i(e=>(e+1)%c.length)},n),()=>clearInterval(o.current)},[c.length,n,s]),(0,r.jsxs)("div",{className:"loading-card",children:[(0,r.jsxs)("div",{className:"loading-ring",children:[(0,r.jsx)("div",{className:"ring"}),(0,r.jsx)("div",{className:"ring blur"})]}),(0,r.jsx)("div",{className:"loading-text",children:(0,r.jsx)("div",{className:"line",children:c[a]})}),(0,r.jsx)("div",{className:"loading-bar",children:(0,r.jsx)("div",{className:"track",children:(0,r.jsx)("span",{className:"fill"})})})]})}},2285:function(e,l,n){"use strict";n.r(l),n.d(l,{default:function(){return c}});var r=n(5893),t=n(7294),s=n(9008),a=n.n(s),i=n(7381);let o=async function(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:900;return Promise.all([e,new Promise(e=>setTimeout(e,l))]).then(e=>{let[l]=e;return l})};function c(){let[e,l]=(0,t.useState)(!1),[n,s]=(0,t.useState)(!1),[c,d]=(0,t.useState)(null);async function u(){d(null),s(!0);try{var e;let l=null===(e=window.Telegram)||void 0===e?void 0:e.WebApp;if(!l){d("Открой мини-апку из Telegram (кнопка \xabОткрыть\xbb в чате бота).");return}let n=l.initData||"";if(!n){d("Telegram не передал initData. Нажми ⋯ → \xabОбновить страницу\xbb.");return}let r=await o(fetch("/api/auth/telegram",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initData:n})}).then(e=>e.json()));r.ok?(localStorage.setItem("profile",JSON.stringify(r.profile||null)),sessionStorage.removeItem("logged_out"),window.location.href="/home"):d(r.error||"Не удалось пройти проверку Telegram.")}catch(e){d("Сетевая ошибка. Попробуй снова.")}finally{s(!1)}}return(0,t.useEffect)(()=>{try{let e=localStorage.getItem("profile"),l="1"===sessionStorage.getItem("logged_out");if(e&&!l){window.location.replace("/home");return}}catch(e){}},[]),(0,t.useEffect)(()=>{var e;let n=null===(e=window.Telegram)||void 0===e?void 0:e.WebApp;n&&(l(!0),n.ready(),n.expand())},[]),(0,t.useEffect)(()=>{if(!n)return;let e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[n]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a(),{children:(0,r.jsx)("title",{children:"Cloudес Market — Вход через Telegram"})}),(0,r.jsx)("div",{className:"container",children:(0,r.jsxs)("div",{className:"hero",children:[(0,r.jsxs)("div",{className:"brand",children:[(0,r.jsx)("img",{src:"/plane.svg",alt:"",width:"18",height:"18"}),(0,r.jsx)("span",{children:"Cloudес Market"})]}),(0,r.jsx)("h1",{className:"h1",children:"Заходи через Telegram"}),(0,r.jsx)("p",{className:"lead",children:"Моментальная авторизация без паролей. Мы получим только твои публичные данные Telegram (имя, юзернейм, аватар) — и создадим профиль."}),(0,r.jsxs)("div",{className:"row",children:[(0,r.jsxs)("button",{className:"btn btn-primary",onClick:u,disabled:n,children:[(0,r.jsx)("img",{src:"/plane.svg",alt:"",width:"18",height:"18"}),n?"Проверяем…":"Continue"]}),(0,r.jsx)("a",{className:"btn btn-ghost",href:"https://t.me/",target:"_blank",rel:"noreferrer",children:"Join our Telegram Community"})]}),(0,r.jsxs)("div",{className:"foot",children:["Продолжая, вы соглашаетесь с"," ",(0,r.jsx)("a",{href:"#",onClick:e=>e.preventDefault(),children:"Политикой конфиденциальности"})," и"," ",(0,r.jsx)("a",{href:"#",onClick:e=>e.preventDefault(),children:"Условиями сервиса"}),"."]}),c&&(0,r.jsxs)("div",{className:"foot",style:{color:"#ffb4b4"},children:["Ошибка: ",c]})]})}),n&&(0,r.jsxs)("div",{className:"overlay","aria-hidden":!0,children:[(0,r.jsx)("div",{className:"overlay-backdrop"}),(0,r.jsxs)("div",{className:"overlay-panel",children:[(0,r.jsx)(i.Z,{messages:["Считываем данные Telegram…","Проверяем подпись WebApp…","Создаём профиль…","Подгружаем аватар…"],intervalMs:600}),(0,r.jsx)("div",{className:"overlay-hint",children:"Это займёт пару секунд…"})]})]})]})}},9008:function(e,l,n){e.exports=n(7828)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{4730:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return a(8375)}])},2106:function(e,t,a){"use strict";a.d(t,{a:function(){return r}});var n=a(7294);function l(){try{localStorage.removeItem("profile"),sessionStorage.removeItem("profile"),sessionStorage.setItem("logged_out","1")}catch(e){}}function r(){let[e,t]=(0,n.useState)(null),[a,r]=(0,n.useState)(!0),[s,i]=(0,n.useState)(null),o=async e=>{try{let a=await fetch("/api/validate-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({telegram_id:e.id})}),n=await a.json();if(!a.ok){if("USER_DELETED"===n.code)return console.log("User was deleted from database, logging out..."),l(),t(null),i("Ваш профиль был удален. Необходимо войти заново."),setTimeout(()=>{window.location.replace("/")},2e3),!1;throw Error(n.error||"Ошибка валидации")}return!0}catch(e){return console.error("Validation error:",e),i(e.message),!1}};return(0,n.useEffect)(()=>{let e=async()=>{try{if("1"===sessionStorage.getItem("logged_out")){t(null),r(!1);return}let e=function(){try{let e=localStorage.getItem("profile");if(e)return JSON.parse(e)}catch(e){}try{let e=sessionStorage.getItem("profile");if(e)return JSON.parse(e)}catch(e){}return null}();if(!e){t(null),r(!1);return}await o(e)&&t(e)}catch(e){console.error("Auth check error:",e),i(e.message),t(null)}finally{r(!1)}};e();let a=setInterval(e,3e4);return()=>clearInterval(a)},[]),{user:e,loading:a,error:s,logout:()=>{l(),t(null),window.location.replace("/")},validateUser:o}}},8375:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var n=a(5893),l=a(7294),r=a(9008),s=a.n(r),i=a(2106);function o(){var e;let{user:t,loading:a}=(0,i.a)(),[r,o]=(0,l.useState)([]),[c,u]=(0,l.useState)(!0),[d,m]=(0,l.useState)(null),[h,x]=(0,l.useState)({title:"",text:"",type:"info",telegram_link:"",display_order:0}),p=t&&["YOUR_TELEGRAM_ID"].includes(null===(e=t.telegram_id)||void 0===e?void 0:e.toString());(0,l.useEffect)(()=>{a||t||window.location.replace("/")},[t,a]),(0,l.useEffect)(()=>{p&&f()},[p]);let f=async()=>{try{let e=await fetch("/api/announcements"),t=await e.json();t.ok&&o(t.announcements)}catch(e){console.error("Error fetching announcements:",e)}finally{u(!1)}},j=async e=>{if(e.preventDefault(),h.title.trim()&&h.text.trim())try{let e=d?"PUT":"POST",t=d?{...h,id:d}:h,a=await fetch("/api/announcements",{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await a.json();n.ok?(await f(),N()):alert("Ошибка: "+n.error)}catch(e){console.error("Error saving announcement:",e),alert("Ошибка сохранения")}},D=e=>{m(e.id),x({title:e.title,text:e.text,type:e.type,telegram_link:e.telegram_link||"",display_order:e.display_order})},g=async e=>{if(confirm("Удалить объявление?"))try{let t=await fetch("/api/announcements?id=".concat(e),{method:"DELETE"});(await t.json()).ok?await f():alert("Ошибка удаления")}catch(e){console.error("Error deleting announcement:",e),alert("Ошибка удаления")}},N=()=>{m(null),x({title:"",text:"",type:"info",telegram_link:"",display_order:0})};return a||c?(0,n.jsx)("div",{className:"container",children:(0,n.jsx)("div",{className:"hero",style:{maxWidth:480},children:(0,n.jsx)("div",{className:"loading-text",children:"Загрузка..."})})}):p?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s(),{children:(0,n.jsx)("title",{children:"Админ-панель — Объявления"})}),(0,n.jsx)("div",{className:"container",children:(0,n.jsxs)("div",{className:"hero",style:{maxWidth:800},children:[(0,n.jsxs)("div",{className:"brand",children:[(0,n.jsx)("a",{href:"/home",style:{color:"var(--muted)",textDecoration:"none"},children:"← Главная"}),(0,n.jsx)("span",{className:"badge",children:"Админ"})]}),(0,n.jsx)("h1",{className:"h1",children:"\uD83D\uDCE2 Управление объявлениями"}),(0,n.jsx)("p",{className:"lead",children:"Создавай и редактируй объявления для главной страницы"}),(0,n.jsx)("form",{onSubmit:j,style:{marginTop:24},children:(0,n.jsxs)("div",{className:"admin-form",children:[(0,n.jsxs)("div",{className:"form-row",children:[(0,n.jsx)("label",{className:"form-label",children:"\uD83D\uDCDD Заголовок:"}),(0,n.jsx)("input",{type:"text",className:"form-input",value:h.title,onChange:e=>x({...h,title:e.target.value}),placeholder:"\uD83C\uDF89 Заголовок объявления...",required:!0})]}),(0,n.jsxs)("div",{className:"form-row",children:[(0,n.jsx)("label",{className:"form-label",children:"\uD83D\uDCC4 Текст:"}),(0,n.jsx)("textarea",{className:"form-textarea",value:h.text,onChange:e=>x({...h,text:e.target.value}),placeholder:"Описание объявления...",rows:"3",required:!0})]}),(0,n.jsxs)("div",{className:"form-row",children:[(0,n.jsx)("label",{className:"form-label",children:"\uD83C\uDFA8 Тип:"}),(0,n.jsxs)("select",{className:"form-select",value:h.type,onChange:e=>x({...h,type:e.target.value}),children:[(0,n.jsx)("option",{value:"welcome",children:"\uD83C\uDF89 Приветствие"}),(0,n.jsx)("option",{value:"auction",children:"\uD83D\uDD25 Аукцион"}),(0,n.jsx)("option",{value:"update",children:"\uD83D\uDC8E Обновление"}),(0,n.jsx)("option",{value:"market",children:"\uD83D\uDED2 Маркет"}),(0,n.jsx)("option",{value:"info",children:"ℹ️ Информация"})]})]}),(0,n.jsxs)("div",{className:"form-row",children:[(0,n.jsx)("label",{className:"form-label",children:"\uD83D\uDD17 Ссылка на пост в Telegram:"}),(0,n.jsx)("input",{type:"url",className:"form-input",value:h.telegram_link,onChange:e=>x({...h,telegram_link:e.target.value}),placeholder:"https://t.me/твой_канал/номер_поста"})]}),(0,n.jsxs)("div",{className:"form-row",children:[(0,n.jsx)("label",{className:"form-label",children:"\uD83D\uDCCA Порядок отображения:"}),(0,n.jsx)("input",{type:"number",className:"form-input",value:h.display_order,onChange:e=>x({...h,display_order:parseInt(e.target.value)||0}),min:"0"})]}),(0,n.jsxs)("div",{className:"form-actions",children:[(0,n.jsx)("button",{type:"submit",className:"btn btn-primary",children:d?"\uD83D\uDCBE Сохранить":"➕ Добавить"}),d&&(0,n.jsx)("button",{type:"button",className:"btn btn-ghost",onClick:N,children:"❌ Отмена"})]})]})}),(0,n.jsxs)("div",{style:{marginTop:32},children:[(0,n.jsx)("h2",{style:{fontSize:20,marginBottom:16},children:"\uD83D\uDCCB Текущие объявления:"}),(0,n.jsxs)("div",{className:"announcements-list",children:[r.map(e=>(0,n.jsxs)("div",{className:"announcement-item",children:[(0,n.jsxs)("div",{className:"announcement-header",children:[(0,n.jsx)("span",{className:"announcement-type",children:e.type}),(0,n.jsxs)("span",{className:"announcement-order",children:["#",e.display_order]})]}),(0,n.jsx)("h3",{className:"announcement-item-title",children:e.title}),(0,n.jsx)("p",{className:"announcement-item-text",children:e.text}),e.telegram_link&&(0,n.jsx)("a",{href:e.telegram_link,target:"_blank",rel:"noopener noreferrer",className:"telegram-link",children:"\uD83D\uDD17 Открыть в Telegram"}),(0,n.jsxs)("div",{className:"announcement-actions",children:[(0,n.jsx)("button",{className:"btn-edit",onClick:()=>D(e),children:"✏️ Изменить"}),(0,n.jsx)("button",{className:"btn-delete",onClick:()=>g(e.id),children:"\uD83D\uDDD1️ Удалить"})]})]},e.id)),0===r.length&&(0,n.jsx)("div",{className:"empty-state",children:"\uD83D\uDCED Объявлений пока нет"})]})]})]})})]}):(0,n.jsx)("div",{className:"container",children:(0,n.jsxs)("div",{className:"hero",style:{maxWidth:480},children:[(0,n.jsx)("h1",{className:"h1",children:"\uD83D\uDEAB Доступ запрещен"}),(0,n.jsx)("p",{className:"lead",children:"У вас нет прав администратора."}),(0,n.jsx)("div",{className:"row",children:(0,n.jsx)("a",{href:"/home",className:"btn btn-primary",children:"← Назад"})})]})})}},9008:function(e,t,a){e.exports=a(7828)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=4730)}),_N_E=e.O()}]);
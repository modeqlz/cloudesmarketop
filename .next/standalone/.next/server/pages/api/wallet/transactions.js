"use strict";(()=>{var e={};e.id=315,e.ids=[315],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},5252:(e,t,r)=>{r.r(t),r.d(t,{config:()=>d,default:()=>c,routeModule:()=>l});var n={};r.r(n),r.d(n,{default:()=>u});var a=r(1802),s=r(7153),i=r(6249),o=r(2020);async function u(e,t){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});let{telegram_id:r,limit:n=10}=e.query;if(!r)return t.status(400).json({error:"Telegram ID is required"});try{let{data:e,error:a}=await o.R.from("wallet_tx").select("*").eq("telegram_id",r).order("created_at",{ascending:!1}).limit(parseInt(n,10));if(a)return console.error("Error fetching transactions:",a),t.status(500).json({error:"Failed to fetch transactions"});let s=e.map(e=>{let t=e.amount_cents/100,r="",n="",a="";switch(e.kind){case"topup":r="Пополнение баланса",n="\uD83D\uDCE5",a="income";break;case"purchase":r=e.description||"Покупка",n="\uD83D\uDED2",a="expense";break;case"withdrawal":r="Вывод средств",n="\uD83D\uDCE4",a="expense";break;case"refund":r="Возврат средств",n="↩️",a="income";break;default:r=e.description||"Операция",n="\uD83D\uDD04",a=""}return{id:e.id,title:r,date:new Date(e.created_at).toLocaleString("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),amount_display:`${t>0?"+":""}${t.toFixed(2)} $`,icon:n,className:a}});t.status(200).json({transactions:s})}catch(e){console.error("Unexpected error in transactions API:",e),t.status(500).json({error:"Internal server error"})}}let c=(0,i.l)(n,"default"),d=(0,i.l)(n,"config"),l=new a.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/wallet/transactions",pathname:"/api/wallet/transactions",bundlePath:"",filename:""},userland:n})},2020:(e,t,r)=>{r.d(t,{R:()=>n});let n=(0,r(2885).createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=5252);module.exports=r})();